version: '3.0'
services:
  web:
    container_name: 8CLD202-Serveur_Web
    ports:
      - "80:5000" # NECESSARY ports for Deployment
    build:
      context: ./Web
      dockerfile: Dockerfile
    volumes:
      - ./Web/app/:/app # Overrides Dockerfile COPY for development
    depends_on:
    - mysql_api
    - iot_api
    deploy:
      placement:
        constraints:
          - node.hostname == Web

  iot_api:
    container_name: 8CLD202-API_pour_IoTDB
    build:
      context: ./IoT_API
      dockerfile: Dockerfile
    ports:
      - "3456:5000" # NECESSARY ports for Deployment
    volumes:
      - ./IoT_API/app/:/app # Overrides Dockerfile COPY for development
    depends_on:
    - mysql_api
    deploy:
      placement:
        constraints:
          - node.hostname == IoT

  mysql_api:
    container_name: 8CLD202-API_pour_MySQL
    build:
      context: ./MySQL_API
      dockerfile: Dockerfile
    volumes:
      - ./MySQL_API/app/:/app # Overrides Dockerfile COPY for development
    depends_on:
    - mysql_db
    deploy:
      placement:
        constraints:
          - node.hostname == MySQL

  mysql_db:
    container_name: 8CLD202-Base_de_Donnees_MySQL
    restart: always
    build:
      context: ./MySQL_DB
      dockerfile: Dockerfile
    deploy:
      placement:
        constraints:
          - node.hostname == MySQL

  iot_db:
    container_name: 8CLD202-Base_de_Donnees_IoTDB
    restart: always
    ports:
      - 6667:6667 # NECESSARY ports for Deployment
      - 9091:9091 # NECESSARY ports for Deployment
    build:
      context: ./IoT_DB
      dockerfile: Dockerfile
    deploy:
        placement:
        constraints:
            - node.hostname == IoT